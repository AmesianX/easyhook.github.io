<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>RemoteHooking.ExecuteAsService(TClass) Method </title><meta name="Language" content="en-us" /><meta name="System.Keywords" content="ExecuteAsService%3CTClass%3E method" /><meta name="System.Keywords" content="ExecuteAsService(Of TClass) method" /><meta name="System.Keywords" content="RemoteHooking.ExecuteAsService%3CTClass%3E method" /><meta name="System.Keywords" content="RemoteHooking.ExecuteAsService(Of TClass) method" /><meta name="Microsoft.Help.F1" content="EasyHook.RemoteHooking.ExecuteAsService``1" /><meta name="Microsoft.Help.Id" content="M:EasyHook.RemoteHooking.ExecuteAsService``1(System.String,System.Object[])" /><meta name="Description" content="Will execute the given static method under system privileges." /><meta name="Microsoft.Help.ContentType" content="Reference" /><meta name="BrandingAware" content="true" /><meta name="container" content="EasyHook" /><meta name="file" content="M_EasyHook_RemoteHooking_ExecuteAsService__1" /><meta name="guid" content="M_EasyHook_RemoteHooking_ExecuteAsService__1" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">EasyHook 2.7 Beta<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="N_EasyHook.htm" title="EasyHook 2.7 Beta" tocid="roottoc">EasyHook 2.7 Beta</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="N_EasyHook.htm" title="EasyHook" tocid="N_EasyHook">EasyHook</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="T_EasyHook_RemoteHooking.htm" title="RemoteHooking Class" tocid="T_EasyHook_RemoteHooking">RemoteHooking Class</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Methods_T_EasyHook_RemoteHooking.htm" title="RemoteHooking Methods" tocid="Methods_T_EasyHook_RemoteHooking">RemoteHooking Methods</a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Overload_EasyHook_RemoteHooking_CreateAndInject.htm" title="CreateAndInject Method " tocid="Overload_EasyHook_RemoteHooking_CreateAndInject">CreateAndInject Method </a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_ExecuteAsService__1.htm" title="ExecuteAsService(TClass) Method " tocid="M_EasyHook_RemoteHooking_ExecuteAsService__1">ExecuteAsService(TClass) Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_GetCurrentProcessId.htm" title="GetCurrentProcessId Method " tocid="M_EasyHook_RemoteHooking_GetCurrentProcessId">GetCurrentProcessId Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_GetCurrentThreadId.htm" title="GetCurrentThreadId Method " tocid="M_EasyHook_RemoteHooking_GetCurrentThreadId">GetCurrentThreadId Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_GetProcessIdentity.htm" title="GetProcessIdentity Method " tocid="M_EasyHook_RemoteHooking_GetProcessIdentity">GetProcessIdentity Method </a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Overload_EasyHook_RemoteHooking_Inject.htm" title="Inject Method " tocid="Overload_EasyHook_RemoteHooking_Inject">Inject Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_InstallDriver.htm" title="InstallDriver Method " tocid="M_EasyHook_RemoteHooking_InstallDriver">InstallDriver Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_InstallSupportDriver.htm" title="InstallSupportDriver Method " tocid="M_EasyHook_RemoteHooking_InstallSupportDriver">InstallSupportDriver Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_IpcConnectClient__1.htm" title="IpcConnectClient(TRemoteObject) Method " tocid="M_EasyHook_RemoteHooking_IpcConnectClient__1">IpcConnectClient(TRemoteObject) Method </a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Overload_EasyHook_RemoteHooking_IpcCreateServer.htm" title="IpcCreateServer Method " tocid="Overload_EasyHook_RemoteHooking_IpcCreateServer">IpcCreateServer Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_IsX64Process.htm" title="IsX64Process Method " tocid="M_EasyHook_RemoteHooking_IsX64Process">IsX64Process Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_EasyHook_RemoteHooking_WakeUpProcess.htm" title="WakeUpProcess Method " tocid="M_EasyHook_RemoteHooking_WakeUpProcess">WakeUpProcess Method </a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>RemoteHooking<span id="LSTE84045D3_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_0?cpp=::|nu=.");</script>ExecuteAsService<span id="LSTE84045D3_1"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_1?cs=&lt;|vb=(Of |cpp=&lt;|fs=&lt;'|nu=(");</script><span class="typeparameter">TClass</span><span id="LSTE84045D3_2"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_2?cs=&gt;|vb=)|cpp=&gt;|fs=&gt;|nu=)");</script> Method </h1></td></tr></table><span class="introStyle"></span>
<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- EasyHookLeaderBoard728x90 -->
<ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-7073730100723702" data-ad-slot="9421789924"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
 <div class="summary">
            Will execute the given static method under system privileges. 
            </div><p> </p>
    <strong>Namespace:</strong> 
   <a href="N_EasyHook.htm">EasyHook</a><br />
    <strong>Assembly:</strong>
   EasyHook (in EasyHook.dll) Version: 2.7.0.0 (2.7.0.0)<div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Syntax</span></div><div id="ID1RBSection" class="collapsibleSection"><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EDCA_tab1" class="codeSnippetContainerTab"><a href="#" onclick="javascript:ChangeTab('ID0EDCA','cs','1','4');return false;">C#</a></div><div id="ID0EDCA_tab2" class="codeSnippetContainerTab"><a href="#" onclick="javascript:ChangeTab('ID0EDCA','vb','2','4');return false;">VB</a></div><div id="ID0EDCA_tab3" class="codeSnippetContainerTab"><a href="#" onclick="javascript:ChangeTab('ID0EDCA','cpp','3','4');return false;">C++</a></div><div id="ID0EDCA_tab4" class="codeSnippetContainerTab"><a href="#" onclick="javascript:ChangeTab('ID0EDCA','fs','4','4');return false;">F#</a></div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EDCA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EDCA');return false;" title="Copy">Copy</a></div></div><div id="ID0EDCA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">Object</span> <span class="identifier">ExecuteAsService</span>&lt;TClass&gt;(
	<span class="identifier">string</span> <span class="parameter">InMethodName</span>,
	<span class="keyword">params</span> <span class="identifier">Object</span>[] <span class="parameter">InParams</span>
)
</pre></div><div id="ID0EDCA_code_Div2" class="codeSnippetContainerCode" style="display: none"><pre xml:space="preserve"><span class="keyword">Public</span> <span class="keyword">Shared</span> <span class="keyword">Function</span> <span class="identifier">ExecuteAsService</span>(<span class="keyword">Of</span> TClass) ( 
	<span class="parameter">InMethodName</span> <span class="keyword">As</span> <span class="identifier">String</span>,
	<span class="keyword">ParamArray</span> <span class="parameter">InParams</span> <span class="keyword">As</span> <span class="identifier">Object</span>()
) <span class="keyword">As</span> <span class="identifier">Object</span></pre></div><div id="ID0EDCA_code_Div3" class="codeSnippetContainerCode" style="display: none"><pre xml:space="preserve"><span class="keyword">public</span>:
<span class="keyword">generic</span>&lt;<span class="keyword">typename</span> TClass&gt;
<span class="keyword">static</span> <span class="identifier">Object</span>^ <span class="identifier">ExecuteAsService</span>(
	<span class="identifier">String</span>^ <span class="parameter">InMethodName</span>, 
	... <span class="keyword">array</span>&lt;<span class="identifier">Object</span>^&gt;^ <span class="parameter">InParams</span>
)</pre></div><div id="ID0EDCA_code_Div4" class="codeSnippetContainerCode" style="display: none"><pre xml:space="preserve"><span class="keyword">static</span> <span class="keyword">member</span> <span class="identifier">ExecuteAsService</span> : 
        <span class="parameter">InMethodName</span> : <span class="identifier">string</span> * 
        <span class="parameter">InParams</span> : <span class="identifier">Object</span>[] <span class="keyword">-&gt;</span> <span class="identifier">Object</span> 
</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EDCA");</script><h4 class="subHeading">Parameters</h4><dl><dt><span class="parameter">InMethodName</span></dt><dd>Type: <a href="http://msdn2.microsoft.com/en-us/library/s1wwdcbf" target="_blank">System<span id="LSTE84045D3_3"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_3?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>String</a><br />A public static method exposed by the given public class.</dd><dt><span class="parameter">InParams</span></dt><dd>Type: <span id="LSTE84045D3_4"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_4?cpp=array&lt;");</script><a href="http://msdn2.microsoft.com/en-us/library/e5kfa45b" target="_blank">System<span id="LSTE84045D3_5"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_5?cs=.|vb=.|cpp=::|nu=.|fs=.");</script>Object</a><span id="LSTE84045D3_6"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_6?cpp=&gt;|vb=()|nu=[]");</script><br />A list of serializable parameters being passed to your static method.</dd></dl><h4 class="subHeading">Type Parameters</h4><dl><dt><span class="parameter">TClass</span></dt><dd>A class containing the given static method.</dd></dl><h4 class="subHeading">Return Value</h4>Type: <a href="http://msdn2.microsoft.com/en-us/library/e5kfa45b" target="_blank">Object</a><br />The same value your method is returning or <span class="code">null</span> if a <span class="code">void</span> method is called.</div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Exceptions</span></div><div id="ID2RBSection" class="collapsibleSection"><div class="tableSection"><table><tr><th>Exception</th><th>Condition</th></tr><tr><td><a href="http://msdn2.microsoft.com/en-us/library/45bkekh3" target="_blank">AccessViolationException</a></td><td>
            The current user is not an administrator.
            </td></tr></table></div></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Remarks</span></div><div id="ID3RBSection" class="collapsibleSection"><p>
            For some tasks it is necessary to have unrestricted access to the windows API.
            For example if you want to enumerate all running processes in all sessions. But
            keep in mind that you only can access these information within the given static
            method and only if it is called through this service.
            </p><p>
            To accomplish this task, your assembly is loaded into a system service which
            executes the given static method in a remoted manner. This implies that the
            return type shall be marked with <a href="http://msdn2.microsoft.com/en-us/library/bcfsa90a" target="_blank">SerializableAttribute</a>. All
            handles or other process specific things obtained in the service, will be invalid 
            in your application after the call is completed! Also the service will use
            a new instance of your class, so you should only rely on the given parameters
            and avoid using any external variables.. Your method shall be threaded as isolated!
            </p><p>
            The next thing to mention is that all assemblies required for executing the method
            shall either be in the GAC or in the directory of the related EasyHook-Library.
            Otherwise the service won't be able to use your assembly!
            </p><p>
            All unhandled exceptions will be rethrown by the local <span class="selflink">ExecuteAsService<span id="LSTE84045D3_7"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_7?cs=&lt;|vb=(Of |cpp=&lt;|fs=&lt;'|nu=(");</script>TClass<span id="LSTE84045D3_8"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_8?cs=&gt;|vb=)|cpp=&gt;|fs=&gt;|nu=)");</script>(String, <span id="LSTE84045D3_9"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_9?cpp=array&lt;");</script>Object<span id="LSTE84045D3_10"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTE84045D3_10?cpp=&gt;|cs=[]|vb=()|nu=[]|fs=[]");</script>)</span>.
            </p></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Examples</span></div><div id="ID4RBSection" class="collapsibleSection"><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAABA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAAABA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAABA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">private</span> <span class="highlight-keyword">static</span> <span class="highlight-keyword">void</span> OnProcessUpdate(Object InCallback)
{
    ProcessTimer.Change(Timeout.Infinite, Timeout.Infinite);

    <span class="highlight-keyword">try</span>
    {
        ProcessInfo[] Array = (ProcessInfo[])RemoteHooking.ExecuteAsService&lt;Form1&gt;(<span class="highlight-literal">"EnumProcesses"</span>);
        SortedDictionary&lt;String, ProcessInfo&gt; Result = <span class="highlight-keyword">new</span> SortedDictionary&lt;<span class="highlight-keyword">string</span>, ProcessInfo&gt;();

        <span class="highlight-comment">// sort by name...</span>
        <span class="highlight-keyword">lock</span> (ProcessList)
        {
            ActivePIDList.Clear();

            <span class="highlight-keyword">for</span> (<span class="highlight-keyword">int</span> i = <span class="highlight-number">0</span>; i &lt; Array.Length; i++)
            {
                Result.Add(System.IO.Path.GetFileName(Array[i].FileName) + <span class="highlight-literal">"____"</span> + i, Array[i]);

                ActivePIDList.Add(Array[i].Id);
            }

            Result.Values.CopyTo(Array, <span class="highlight-number">0</span>);

            ProcessList.Clear();

            ProcessList.AddRange(Array);
        }
    }
    <span class="highlight-keyword">catch</span> (AccessViolationException)
    {
        MessageBox.Show(<span class="highlight-literal">"This is an administrative task!"</span>, <span class="highlight-literal">"Permission denied..."</span>, MessageBoxButtons.OK);

        Process.GetCurrentProcess().Kill();
    }
    <span class="highlight-keyword">finally</span>
    {
        ProcessTimer.Change(<span class="highlight-number">5000</span>, <span class="highlight-number">5000</span>);
    }
}

[Serializable]
<span class="highlight-keyword">public</span> <span class="highlight-keyword">class</span> ProcessInfo
{
    <span class="highlight-keyword">public</span> String FileName;
    <span class="highlight-keyword">public</span> Int32 Id;
    <span class="highlight-keyword">public</span> Boolean Is64Bit;
    <span class="highlight-keyword">public</span> String User;
}

<span class="highlight-keyword">public</span> <span class="highlight-keyword">static</span> ProcessInfo[] EnumProcesses()
{
    List&lt;ProcessInfo&gt; Result = <span class="highlight-keyword">new</span> List&lt;ProcessInfo&gt;();
    Process[] ProcList = Process.GetProcesses();

    <span class="highlight-keyword">for</span> (<span class="highlight-keyword">int</span> i = <span class="highlight-number">0</span>; i &lt; ProcList.Length; i++)
    {
        Process Proc = ProcList[i];

        <span class="highlight-keyword">try</span>
        {
            ProcessInfo Info = <span class="highlight-keyword">new</span> ProcessInfo();

            Info.FileName = Proc.MainModule.FileName;
            Info.Id = Proc.Id;
            Info.Is64Bit = RemoteHooking.IsX64Process(Proc.Id);
            Info.User = RemoteHooking.GetProcessIdentity(Proc.Id).Name;

            Result.Add(Info);
        }
        <span class="highlight-keyword">catch</span>
        {
        }
    }

    <span class="highlight-keyword">return</span> Result.ToArray();
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAABA");</script></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID5RB')" onkeypress="SectionExpandCollapse_CheckKey('ID5RB', event)" tabindex="0"><img id="ID5RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span></div><div id="ID5RBSection" class="collapsibleSection"><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><a href="T_EasyHook_RemoteHooking.htm">RemoteHooking Class</a></div><div class="seeAlsoStyle"><a href="N_EasyHook.htm">EasyHook Namespace</a></div></div></div></div><div id="pageFooter" class="pageFooter">Documentation built 2017-02-05.<p><a href="https://easyhook.github.io/" target="_blank">Copyright (C) 2009 Christoph Husse &amp; (C) 2012-2015 Justin Stenning</a></p>
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
  var pageTracker = _gat._getTracker("UA-66127710-1");
  pageTracker._trackPageview();
} catch(err) {}
</script> </div></body></html>